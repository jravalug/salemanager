{% extends "base.html" %}

{% block vendor_javascript %}
  <script src="{{ url_for('main.node_modules', filename='simple-datatables/dist/umd/simple-datatables.js') }}"></script>
{% endblock vendor_javascript %}
{% block content %}
  <section class="bg-gray-50 dark:bg-gray-900">
    <div class="">
      <div class="bg-white shadow-md dark:bg-gray-800 sm:rounded-lg">
        <h3 class="text-2xl font-bold text-gray-800 dark:text-white p-6">
          Gestión de Ventas - {{ business.name }}
        </h3>
        <div
          class="flex flex-col px-4 py-3 space-y-3 lg:flex-row lg:items-center lg:justify-between lg:space-y-0 lg:space-x-4"
        >
          <div class="flex items-center flex-1 space-x-4">
            <h5>
              <span class="text-gray-500">Ventas:</span>
              <span class="dark:text-white">{{ all_sales|length }}</span>
            </h5>
            <h5>
              <span class="text-gray-500">Total ventas:</span>
              <span class="dark:text-white">
                {% if selected_month %}
                  {{ month_totals.get(selected_month, 0) | currency }}
                {% else %}
                  {{ month_totals.values() | sum | currency }}
                {% endif %}
              </span>
            </h5>
          </div>
          <div
            class="flex flex-col flex-shrink-0 space-y-3 md:flex-row md:items-center lg:justify-end md:space-y-0 md:space-x-3"
          >
            <button
              type="button"
              data-modal-target="add_sale_modal"
              data-modal-toggle="add_sale_modal"
              class="flex items-center justify-center px-4 py-2 text-sm font-medium text-white rounded-lg bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 dark:bg-primary-600 dark:hover:bg-primary-700 focus:outline-none dark:focus:ring-primary-800"
            >
              <svg
                class="h-3.5 w-3.5 mr-2"
                fill="currentColor"
                viewbox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <path
                  clip-rule="evenodd"
                  fill-rule="evenodd"
                  d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                />
              </svg>
              Agregar venta
            </button>
            <form
              method="get"
              action="{{ url_for('sale.sales', business_id=business.id) }}"
              class="flex items-center space-x-2"
            >
              <label for="month_top" class="sr-only">Filtrar por mes</label>
              <select
                id="month_top"
                name="month"
                onchange="this.form.submit()"
                class="text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-primary-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700"
              >
                <option value="">Todos</option>
                {% if months_display %}
                  {% for m, label in months_display %}
                    <option
                      value="{{ m }}"
                      {% if m == selected_month %}selected{% endif %}
                    >
                      {{ label }}
                    </option>
                  {% endfor %}
                {% else %}
                  {% if months %}
                    {% for m in months %}
                      <option
                        value="{{ m }}"
                        {% if m == selected_month %}selected{% endif %}
                      >
                        {{ m }}
                      </option>
                    {% endfor %}
                  {% endif %}
                {% endif %}
              </select>
              <!-- Fallback button for users without JS -->
              <noscript>
                <button
                  type="submit"
                  class="inline-flex items-center rounded-lg bg-primary-700 px-3 py-2 text-sm font-medium text-white hover:bg-primary-800"
                >
                  Filtrar
                </button>
              </noscript>
            </form>
          </div>
        </div>
        <div class="overflow-x-auto min-h-52 md:min-h-64 lg:min-h-72">
          <table
            class="w-full text-sm text-left text-gray-500 dark:text-gray-400"
          >
            <thead
              class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"
            >
              <tr>
                <th scope="col" class="px-4 py-3 text-left">Día</th>
                <th scope="col" class="px-4 py-3 text-center">Órdenes</th>
                <th scope="col" class="px-4 py-3 text-center">Productos</th>
                <th scope="col" class="px-4 py-3 text-left">Ventas</th>
                <th scope="col" class="px-4 py-3 text-right">Ingresos</th>
              </tr>
            </thead>
            <tbody>
              {% if daily_sales_sorted and daily_sales_sorted|length > 0 %}
                {% for date, data in daily_sales_sorted %}
                  {% set parts = date.split('-') %}
                  {% set formatted_date = parts[2] ~ '/' ~ parts[1] ~ '/' ~ parts[0] %}
                  {% set sales_count = data.sales|length %}
                  <tr
                    class="border-b dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer clickable-row"
                    data-date="{{ date }}"
                    tabindex="0"
                    role="button"
                    aria-expanded="false"
                  >
                    <td
                      class="px-4 py-2 font-medium text-gray-900 whitespace-nowrap dark:text-white"
                    >
                      {{ formatted_date }}
                    </td>
                    <td class="px-4 py-2 text-center">{{ sales_count }}</td>
                    <td class="px-4 py-2 text-center">
                      {{ data.total_products }}
                    </td>

                    <td class="px-4 py-2">
                      {% for sale in data.sales %}
                        <a
                          href="{{ url_for('sale.details', business_id=business.id, sale_id=sale.id) }}"
                          class="inline-block me-2 hover:underline {{ 'text-blue-500 dark:text-blue-400' if sale.has_specific_business() }}{{ 'text-red-500 dark:text-red-400' if sale.excluded }}"
                        >
                          {{ 'TRF-' if sale.is_transfer() }}[{{ sale.sale_number }}]
                        </a>
                      {% endfor %}
                    </td>
                    <td class="px-4 py-2 text-right">
                      <div class="flex items-center">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewbox="0 0 24 24"
                          fill="currentColor"
                          class="w-5 h-5 mr-2 text-gray-400"
                          aria-hidden="true"
                        >
                          <path
                            d="M2.25 2.25a.75.75 0 000 1.5h1.386c.17 0 .318.114.362.278l2.558 9.592a3.752 3.752 0 00-2.806 3.63c0 .414.336.75.75.75h15.75a.75.75 0 000-1.5H5.378A2.25 2.25 0 017.5 15h11.218a.75.75 0 00.674-.421 60.358 60.358 0 002.96-7.228.75.75 0 00-.525-.965A60.864 60.864 0 005.68 4.509l-.232-.867A1.875 1.875 0 003.636 2.25H2.25zM3.75 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM16.5 20.25a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z"
                          />
                        </svg>

                        {{ data.total_income | currency }}
                      </div>
                    </td>
                  </tr>
                  <tr class="details-row hidden bg-gray-50 dark:bg-gray-800">
                    <td colspan="5" class="px-4 py-3">
                      <div class="space-y-2">
                        {% for sale in data.sales %}
                          <div
                            class="p-3 bg-white dark:bg-gray-900 rounded border"
                          >
                            <div
                              class="flex flex-col md:flex-row md:items-start md:justify-between md:space-x-4"
                            >
                              <div class="flex-1">
                                <div class="flex items-baseline space-x-3">
                                  <a
                                    href="{{ url_for('sale.details', business_id=business.id, sale_id=sale.id) }}"
                                    class="font-medium hover:underline {{ 'text-blue-500 dark:text-blue-400' if sale.has_specific_business() }}{{ 'text-red-500 dark:text-red-400' if sale.excluded }}"
                                    >{{ 'TRF-' if sale.is_transfer() }}[{{ sale.sale_number }}]</a
                                  >
                                  <span class="text-xs text-gray-500"
                                    >{% if sale.date %}{{ sale.date.strftime('%d/%m/%Y') }}{% endif %}</span
                                  >
                                  <span class="text-xs text-gray-400">•</span>
                                  <span class="text-xs text-gray-500"
                                    >{{ sale.payment_method }}</span
                                  >
                                  <span class="text-xs text-gray-400">•</span>
                                  <span class="text-xs text-gray-500"
                                    >{{ sale.status }}</span
                                  >
                                </div>
                                {% if sale.customer_name %}
                                  <div
                                    class="text-sm text-gray-600 dark:text-gray-300 mt-1"
                                  >
                                    Cliente:
                                    <span
                                      class="font-medium text-gray-800 dark:text-white"
                                      >{{ sale.customer_name }}</span
                                    >
                                  </div>
                                {% endif %}
                                {% set summary = sale_summaries.get(sale.id) if sale_summaries is defined else none %}
                                {% if summary %}
                                  <div
                                    class="mt-2 text-sm text-gray-600 dark:text-gray-300"
                                  >
                                    <strong class="text-xs text-gray-500"
                                      >Productos (resumen):</strong
                                    >
                                    <ul
                                      class="mt-1 list-disc list-inside text-xs"
                                    >
                                      {% for p in summary %}
                                        <li>
                                          {{ p.name }} — {{ p.quantity }} ×
                                          {{ p.unit_price | currency }}
                                          <span class="text-gray-500"
                                            >({{ p.total_price | currency }})</span
                                          >
                                        </li>
                                      {% endfor %}
                                    </ul>
                                  </div>
                                {% elif sale.products and sale.products|length > 0 %}
                                  <div
                                    class="mt-2 text-sm text-gray-600 dark:text-gray-300"
                                  >
                                    <strong class="text-xs text-gray-500"
                                      >Productos:</strong
                                    >
                                    <ul
                                      class="mt-1 list-disc list-inside text-xs"
                                    >
                                      {% for p in sale.products %}
                                        <li>
                                          {{ p.product.name if p.product else 'N/A' }}
                                          — {{ p.quantity }} ×
                                          {{ p.unit_price | currency }}
                                          <span class="text-gray-500"
                                            >({{ p.total_price | currency }})</span
                                          >
                                        </li>
                                      {% endfor %}
                                    </ul>
                                  </div>
                                {% endif %}
                              </div>

                              <div
                                class="mt-3 md:mt-0 md:flex md:flex-col md:items-end md:justify-center"
                              >
                                <div class="text-sm text-gray-500">
                                  Subtotal:
                                  <span
                                    class="font-medium text-gray-900 dark:text-white"
                                    >{{ sale.subtotal_amount | currency }}</span
                                  >
                                </div>
                                <div class="text-sm text-gray-500">
                                  Descuento:
                                  <span
                                    class="font-medium text-gray-900 dark:text-white"
                                    >{{ sale.discount | currency }}</span
                                  >
                                </div>
                                <div class="text-sm text-gray-500">
                                  Impuesto:
                                  <span
                                    class="font-medium text-gray-900 dark:text-white"
                                    >{{ sale.tax | currency }}</span
                                  >
                                </div>
                                <div
                                  class="text-base font-semibold text-gray-900 dark:text-white mt-1"
                                >
                                  Total: {{ sale.total_amount | currency }}
                                </div>
                              </div>
                            </div>
                          </div>
                        {% endfor %}
                      </div>
                    </td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td
                    colspan="6"
                    class="px-4 py-4 text-center text-gray-600 dark:text-gray-300"
                  >
                    No hay ventas registradas.
                  </td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
        <nav class="w-full p-4" aria-label="Paginación por mes">
          <div class="flex items-center justify-between">
            <div class="flex-1 flex justify-start">
              {% if prev_month %}
                <a
                  href="{{ url_for('sale.sales', business_id=business.id, month=prev_month) }}"
                  class="inline-flex items-center px-4 py-2 text-sm font-medium text-white rounded-lg bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 dark:bg-primary-600 dark:hover:bg-primary-700 focus:outline-none"
                >
                  &larr; Anterior
                </a>
              {% else %}
                <button
                  type="button"
                  disabled
                  class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-400 bg-gray-100 rounded-lg cursor-not-allowed"
                >
                  &larr; Anterior
                </button>
              {% endif %}
            </div>

            <div class="flex-1 text-center">
              <span class="text-sm font-semibold text-gray-900 dark:text-white"
                >{{ display_month_name }}</span
              >
            </div>

            <div class="flex-1 flex justify-end">
              {% if next_month %}
                <a
                  href="{{ url_for('sale.sales', business_id=business.id, month=next_month) }}"
                  class="inline-flex items-center px-4 py-2 text-sm font-medium text-white rounded-lg bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 dark:bg-primary-600 dark:hover:bg-primary-700 focus:outline-none"
                >
                  Siguiente &rarr;
                </a>
              {% else %}
                <button
                  type="button"
                  disabled
                  class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-400 bg-gray-100 rounded-lg cursor-not-allowed"
                >
                  Siguiente &rarr;
                </button>
              {% endif %}
            </div>
          </div>
        </nav>
        <script>
          (function () {
            function toggleDetails(row) {
              var next = row.nextElementSibling;
              if (!next || !next.classList.contains("details-row")) return;
              var isHidden = next.classList.contains("hidden");
              if (isHidden) {
                next.classList.remove("hidden");
                row.setAttribute("aria-expanded", "true");
              } else {
                next.classList.add("hidden");
                row.setAttribute("aria-expanded", "false");
              }
            }

            document.addEventListener("DOMContentLoaded", function () {
              var rows = document.querySelectorAll(".clickable-row");
              rows.forEach(function (r) {
                r.addEventListener("click", function (e) {
                  if (e.target.closest("a")) return; // don't toggle when clicking a link
                  toggleDetails(r);
                });
                r.addEventListener("keydown", function (e) {
                  if (
                    e.key === "Enter" ||
                    e.key === " " ||
                    e.key === "Spacebar"
                  ) {
                    e.preventDefault();
                    toggleDetails(r);
                  }
                });
              });
            });
          })();
        </script>
      </div>
    </div>
  </section>

  {# Modal Agregar Venta #}
  <div
    id="add_sale_modal"
    tabindex="-1"
    aria-hidden="true"
    class="antialiased fixed left-0 right-0 top-0 z-50 hidden h-[calc(100%-1rem)] max-h-auto w-full items-center justify-center overflow-y-auto overflow-x-hidden md:inset-0"
  >
    <div class="relative max-h-auto w-full max-w-lg p-4">
      <!-- Modal content -->
      <div class="relative rounded-lg bg-white shadow dark:bg-gray-800">
        <!-- Modal header -->
        <div
          class="flex items-center justify-between rounded-t border-b border-gray-200 p-4 dark:border-gray-700 md:p-5"
        >
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
            Actualizar Venta
          </h3>
          <button
            type="button"
            class="ms-auto inline-flex h-8 w-8 items-center justify-center rounded-lg bg-transparent text-sm text-gray-400 hover:bg-gray-200 hover:text-gray-900 dark:hover:bg-gray-600 dark:hover:text-white"
            data-modal-toggle="add_sale_modal"
          >
            <svg
              class="h-3 w-3"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 14 14"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
              />
            </svg>
            <span class="sr-only">Cerrar modal</span>
          </button>
        </div>
        <!-- Modal body -->
        <form
          method="post"
          class="p-4 md:p-5"
          action="{{ url_for('sale.sales', business_id=business.id) }}"
        >
          <div class="grid grid-cols-1 gap-4 sm:grid-cols-4 mb-5">
            <!-- Campo Oculto CSRF -->
            {{ add_sale_form.hidden_tag() }}

            <!-- Campo de Negocio Específico -->
            {% if business.is_general and business.sub_businesses.count() > 0 %}
              <div class="sm:col-span-4">
                {{ add_sale_form.specific_business_id.label(class="block mb-2 text-sm font-medium text-gray-900 dark:text-white") }}
                {{
                  add_sale_form.specific_business_id(
                    class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500",
                    placeholder="Número de venta ..."
                  )
                }}
                {% for error in add_sale_form.specific_business_id.errors %}
                  <span class="mt-2 text-sm text-red-600 dark:text-red-500"
                    >{{ error }}</span
                  >
                {% endfor %}
              </div>
            {% endif %}

            <!-- Campo de Numero de venta -->
            <div class="sm:col-span-2">
              {{ add_sale_form.sale_number.label(class="block mb-2 text-sm font-medium text-gray-900 dark:text-white") }}
              {{
                add_sale_form.sale_number(
                  class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500",
                  placeholder="Número de venta ..."
                )
              }}
              {% for error in add_sale_form.sale_number.errors %}
                <span class="mt-2 text-sm text-red-600 dark:text-red-500"
                  >{{ error }}</span
                >
              {% endfor %}
            </div>

            <!-- Campo de Fecha -->
            <div class="sm:col-span-2">
              {{ add_sale_form.date.label(class="block mb-2 text-sm font-medium text-gray-900 dark:text-white") }}
              {{
                add_sale_form.date(
                  class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500",
                  placeholder="Fecha de venta ...",
                  type="date",
                  required=True
                )
              }}
              {% for error in add_sale_form.date.errors %}
                <span class="mt-2 text-sm text-red-600 dark:text-red-500"
                  >{{ error }}</span
                >
              {% endfor %}
            </div>

            <!-- Selector de Metodo de Pago -->
            <div class="sm:col-span-2">
              {{ add_sale_form.payment_method.label(class="block mb-2 text-sm font-medium text-gray-900 dark:text-white") }}
              {{
                add_sale_form.payment_method(
                  class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500",
                  placeholder="Método de pago ..."
                )
              }}
              {% for error in add_sale_form.payment_method.errors %}
                <span class="mt-2 text-sm text-red-600 dark:text-red-500"
                  >{{ error }}</span
                >
              {% endfor %}
            </div>

            <!-- Selector de Estado -->
            <div class="sm:col-span-2">
              {{ add_sale_form.status.label(class="block mb-2 text-sm font-medium text-gray-900 dark:text-white") }}
              {{
                add_sale_form.status(
                  class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500",
                  placeholder="Estado ..."
                )
              }}
              {% for error in add_sale_form.status.errors %}
                <span class="mt-2 text-sm text-red-600 dark:text-red-500"
                  >{{ error }}</span
                >
              {% endfor %}
            </div>

            <!-- Campo de Nombre del cliente -->
            <div class="sm:col-span-4">
              {{ add_sale_form.customer_name.label(class="block mb-2 text-sm font-medium text-gray-900 dark:text-white") }}
              {{
                add_sale_form.customer_name(
                  class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500",
                  placeholder="Nombre del cliente ..."
                )
              }}
              {% for error in add_sale_form.customer_name.errors %}
                <span class="mt-2 text-sm text-red-600 dark:text-red-500"
                  >{{ error }}</span
                >
              {% endfor %}
            </div>

            <!-- Campo de Descuento -->
            <div class="sm:col-span-2">
              {{ add_sale_form.discount.label(class="block mb-2 text-sm font-medium text-gray-900 dark:text-white") }}
              {{
                add_sale_form.discount(
                  class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500",
                  placeholder="Descuento ...",
                  step="0.01",
                  type="number"
                )
              }}
              {% for error in add_sale_form.discount.errors %}
                <span class="mt-2 text-sm text-red-600 dark:text-red-500"
                  >{{ error }}</span
                >
              {% endfor %}
            </div>

            <!-- Campo de Impuesto -->
            <div class="sm:col-span-2">
              {{ add_sale_form.tax.label(class="block mb-2 text-sm font-medium text-gray-900 dark:text-white") }}
              {{
                add_sale_form.tax(
                  class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500",
                  placeholder="IVA ...",
                  step="0.01",
                  type="number"
                )
              }}
              {% for error in add_sale_form.tax.errors %}
                <span class="mt-2 text-sm text-red-600 dark:text-red-500"
                  >{{ error }}</span
                >
              {% endfor %}
            </div>

            <!-- Campo de Venta excluida -->
            <div class="sm:col-span-4">
              {{ add_sale_form.excluded.label(class="block mb-2 text-sm font-medium text-gray-900 dark:text-white") }}
              <div class="flex items-center mb-4">
                {{
                  add_sale_form.excluded(
                    class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded-lg focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",
                    type="checkbox"
                  )
                }}
                <div
                  class="ms-2 text-sm font-medium text-gray-900 dark:text-gray-300"
                >
                  {{ add_sale_form.excluded.description }}
                </div>
                {% for error in add_sale_form.excluded.errors %}
                  <span class="mt-2 text-sm text-red-600 dark:text-red-500"
                    >{{ error }}</span
                  >
                {% endfor %}
              </div>
            </div>
          </div>
          <div
            class="border-t border-gray-200 pt-4 dark:border-gray-700 md:pt-5"
          >
            <button
              type="submit"
              class="me-2 inline-flex items-center rounded-lg bg-primary-700 px-5 py-2.5 text-center text-sm font-medium text-white hover:bg-primary-800 focus:outline-none focus:ring-4 focus:ring-primary-300 dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800"
            >
              Agregar Venta
            </button>
            <button
              type="button"
              data-modal-toggle="add_sale_modal"
              class="me-2 rounded-lg border border-gray-200 bg-white px-5 py-2.5 text-sm font-medium text-gray-900 hover:bg-gray-100 hover:text-primary-700 focus:z-10 focus:outline-none focus:ring-4 focus:ring-gray-100 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white dark:focus:ring-gray-700"
            >
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
{% endblock %}

{% block custom_javascript %}
  <script type="application/javascript">
    (function () {
      if (
        typeof simpleDatatables === "undefined" ||
        typeof simpleDatatables.DataTable === "undefined"
      )
        return;

      // Initialize all tables with the .sales-table class
      document.querySelectorAll(".sales-table").forEach(function (table) {
        try {
          new simpleDatatables.DataTable(table, {
            paging: true,
            sortable: true,
          });
        } catch (e) {
          // ignore individual table init errors
          console.warn("simple-datatables init error", e);
        }
      });

      // Backwards compatibility: single table with id
      var single = document.getElementById("sales-table");
      if (single) {
        try {
          new simpleDatatables.DataTable(single, {
            paging: true,
            sortable: true,
          });
        } catch (e) {
          console.warn("simple-datatables init error", e);
        }
      }
    })();
  </script>
{% endblock custom_javascript %}
